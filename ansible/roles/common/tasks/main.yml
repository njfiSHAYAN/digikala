---
- name: Check if Helm binary exists.
  ansible.builtin.stat:
    path: "{{ helm_bin_path }}"
  register: helm_check

- name: Add helm key and repository
  become: true  
  block:
    - name: 'Add helm key'
      ansible.builtin.apt_key:
        url: "https://baltocdn.com/helm/signing.asc"
        state: present

    - name: Install apt-transport-https 
      ansible.builtin.apt:
        update_cache: yes
        name: apt-transport-https 
        state: present

    - name: 'Add helm repository'
      ansible.builtin.apt_repository:
        repo: "deb https://baltocdn.com/helm/stable/debian/ all main"
        state: present
  when: not helm_check.stat.exists
        
- name: Install helm
  become: true
  ansible.builtin.apt:
    update_cache: yes
    name: helm
    state: present
  when: not helm_check.stat.exists